---
title: "P8110 Homework 5"
author: "Nick Williams"
date: "October 9, 2018"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{}
data hw5; 
	infile "C:\Users\niwi8\OneDrive\Documents\fall_2018\regression\homework\p8110_hw5\HW5data.csv"
		delimiter= ',' missover dsd; 
	input id len_follow final_stat mi_ord bmi year age_c; 
run; 
```

## Problem 1

```{}
proc phreg data = hw5; 
	class mi_ord (ref = "0") / param = ref; 
	model len_follow * final_stat(0) = mi_ord / risklimits covb ties = efron; 
	title "Cox model, length of follow-up as a function of MI order"; 
run; 
```

$$
\begin{aligned}
h(t, x, \beta) = h_0(t)e^{\beta_1(x_1)} & & \text{where, } x_1 = 
\begin{cases}
0 \text{ if first MI} \\
1 \text{ if recurrent MI}
\end{cases}
\end{aligned}
$$  


1. $H_0: \beta_1 = 0$  
   $H_A: \beta_1 \neq 0$  
   
2. Using a likelihood ratio test: 
   $$G = 9.1431 \sim \chi^2_1 \text{ under the null}$$
   $$p = P(\chi^2_1 \geq 9.1431) = 0.0025$$
   
3. $0.0025 < 0.05 \rightarrow$ reject the null hypothesis

4. There is sufficient evidence to conclude that, at the 5% significance level, the rate of death is different between patients with first time MI and patients with recurrent MI. The risk of death among patients with recurrent MI is 1.53 times the risk of death among patients experiencing MI for the first time. 

## Problem 2

```{}
proc phreg data = hw5; 
	class mi_ord (ref = "0")
		  age_c (ref = "1")
		  year (ref = "1") / param = ref; 
	model len_follow * final_stat(0) = mi_ord age_c bmi year 
	      / risklimits covb ties = efron; 
	title "Cox model, length of follow-up as a function of MI order, 
	       age category, bmi, and cohort year"; 
run; 
```

## Problem 3

```{}
proc phreg data = hw5; 
	class mi_ord (ref = "0")
		  age_c (ref = "1")
		  year (ref = "1") / param = ref; 
	model len_follow * final_stat(0) = mi_ord age_c bmi year mi_ord * age_c 
	      / risklimits covb ties = efron; 
	hazardratio mi_ord / at (age_c = "2") diff = all; 
	baseline out = model_3 survival = surv lower = lcl upper = ucl; 
	title "Cox model, length of follow-up as a function of MI order, 
	       age category, bmi, cohort year, interaction between 
		   MI order and age category"; 
run;
```

## Problem 4

```{}
data surv_pred; 
	input id mi_ord age_c bmi year; 
	cards; 
	1 1 4 30 3
	; 
run; 

proc phreg data = hw5 plots(cl) = survival; 
	class mi_ord (ref = "0")
		  age_c (ref = "1")
		  year (ref = "1") / param = ref; 
	model len_follow * final_stat(0) = mi_ord age_c bmi year mi_ord * age_c 
	      / risklimits covb ties = efron; 
	baseline covariates = surv_pred out = pred survival = _all_ / rowid = id; 
run; 

proc print data = pred; 
run; 
```




